<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aposta Sem Risco - Calculadora de Dutching</title>

  <link rel="icon" href="aposta_sem_risco_favicon.png" type="image/png"> 
  
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700;800;900&display=swap" rel="stylesheet">
  
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    /* Variáveis CSS para o Tema Claro (padrão) */
    :root {
        --body-bg-start: #f0f4f8; 
        --body-bg-end: #ffffff;   
        --card-bg: #ffffff;
        --text-color-primary: #2c3e50; 
        --text-color-secondary: #607d8b; 
        --heading-color: #2c3e50; 
        
        --button-primary-bg: #4a90e2; 
        --button-primary-border: #357bd2;
        --button-primary-text: white;
        
        --button-secondary-bg: #e74c3c; 
        --button-secondary-border: #cf3a2a;
        --button-secondary-text: white;
        
        --button-highlight-bg: #f39c12; 
        --button-highlight-border: #e08e0b;
        --button-highlight-text: white;

        --table-header-bg: #34495e; 
        --table-header-text: white;
        
        --badge-success-bg: #2ecc71; 
        --badge-danger-bg: #e74c3c; 
        --badge-secondary-bg: #95a5a6; 
        
        --input-bg: white;
        --input-border: #c3d2e0; 
        --input-text-addon-bg: #eef2f6; 
        --input-text-addon-border: #c3d2e0;
        
        --copy-btn-color: #3498db;
        --info-badge-bg: #4a627a; 
        --info-link-color: #3498db;
        
        /* Cores do Toggle Switch - CLARO */
        --toggle-bg-off: #b0c4de; 
        --toggle-circle-off: #ffffff; 
        --toggle-bg-on: #25a0e0; 
        --toggle-circle-on: #ffffff;
        --toggle-icon-color-off: #4a627a; 
        --toggle-icon-color-on: #ffffff; 
    }

    /* Variáveis CSS para o Tema Escuro: Profundo e com contrastes de alta tecnologia */
    .dark-theme {
        --body-bg-start: #1a1a2e; 
        --body-bg-end: #121820;   
        --card-bg: #1f2a38; 
        --text-color-primary: #e0e6ed; 
        --text-color-secondary: #a7b7c9; 
        --heading-color: #e0e6ed;
        
        --button-primary-bg: #287bff; 
        --button-primary-border: #216ad0;
        --button-primary-text: white;
        
        --button-secondary-bg: #c0392b; 
        --button-secondary-border: #a02c21;
        --button-secondary-text: white;
        
        --button-highlight-bg: #f0c23e; 
        --button-highlight-border: #d0a530;
        --button-highlight-text: #1a1a2e; 

        --table-header-bg: #1e2e3f; 
        --table-header-text: #e0e6ed;
        
        --badge-success-bg: #2ecc71;
        --badge-danger-bg: #e74c3c;
        --badge-secondary-bg: #7f8c8d;
        
        --input-bg: #3a4c5e; 
        --input-border: #5c758e;
        --input-text-addon-bg: #4a5c6f;
        --input-text-addon-border: #5c758e;
        
        --copy-btn-color: #79c1f0;
        --info-badge-bg: #3a4c5e;
        --info-link-color: #79c1f0;

        /* Cores do Toggle Switch - ESCURO */
        --toggle-bg-off: #556c88; 
        --toggle-circle-off: #e0e6ed;
        --toggle-bg-on: #287bff; 
        --toggle-circle-on: #e0e6ed;
        --toggle-icon-color-off: #e0e6ed; 
        --toggle-icon-color-on: #ffffff; 
    }

    body {
      background: linear-gradient(to right, var(--body-bg-start), var(--body-bg-end)) !important; 
      font-family: 'Poppins', sans-serif !important; 
      display: block;
      min-height: 100vh;
      padding: 0;
      color: var(--text-color-primary) !important; 
      transition: background-color 0.5s ease; 
    }
    .container-custom {
        background-color: var(--card-bg) !important;
        border-radius: 1.25rem !important; 
        box-shadow: 0 15px 35px rgba(0,0,0,0.3) !important; 
        padding: 3rem !important; 
        width: 95% !important;
        margin: 2.5rem auto !important;
        max-width: 1000px !important; 
        position: relative; 
        overflow: hidden; 
        transition: background-color 0.5s ease, box-shadow 0.5s ease; 
    }
    h1 {
      font-family: 'Orbitron', sans-serif !important; /* MUDANÇA DE FONTE PARA ORBITRON */
      color: var(--heading-color) !important; 
      font-weight: 700 !important; 
      margin-top: 0.5rem !important; 
      margin-bottom: 1rem !important; 
      letter-spacing: 0.05em; 
      font-size: 3.8rem !important; /* AUMENTADO O TAMANHO DA FONTE DO TÍTULO */
      text-shadow: 1px 1px 2px rgba(0,0,0,0.05); 
    }
    .logo-display { 
        text-align: center;
        margin-bottom: 0.5rem; 
    }
    .logo-display img {
        max-width: 100%;
        height: auto;
        max-height: 220px; 
        display: inline-block; 
        margin: 0 auto; 
        filter: drop-shadow(0 8px 15px rgba(0,0,0,0.1)); 
    }

    #lucroDisplay, #retornoTotalDisplay {
        font-size: 1.25rem !important; 
        font-weight: 700 !important; 
        padding: 0.8rem 1.5rem !important; 
        border-radius: 0.8rem !important; 
        display: inline-block !important;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15); 
        min-width: 120px; 
        text-align: center;
    }
    #lucroDisplay.bg-success-custom { background-color: var(--badge-success-bg) !important; color: white !important; }
    #lucroDisplay.bg-danger-custom { background-color: var(--badge-danger-bg) !important; color: white !important; }
    #retornoTotalDisplay.bg-secondary-custom { background-color: var(--badge-secondary-bg) !important; color: white !important; }

    .table-dark th {
        background-color: var(--table-header-bg) !important; 
        color: var(--table-header-text) !important;
        text-align: center !important;
        padding: 1.2rem !important; 
        border-bottom: 2px solid rgba(255,255,255,0.15) !important; 
        font-weight: 600 !important;
    }
    .table-responsive { margin-top: 2.5rem !important; }
    
    .input-group-text {
        background-color: var(--input-text-addon-bg) !important;
        border: 1px solid var(--input-text-addon-border) !important;
        color: var(--text-color-primary) !important; 
        border-radius: 0.6rem 0 0 0.6rem !important; 
        padding: 0.75rem 1.2rem !important; 
        font-weight: 500;
    }
    .form-control { 
        background-color: var(--input-bg) !important;
        border: 1px solid var(--input-border) !important;
        color: var(--text-color-primary) !important; 
        border-radius: 0 0.6rem 0.6rem 0 !important; 
        padding: 0.75rem 1rem !important; 
        box-shadow: inset 0 1px 4px rgba(0,0,0,0.08); 
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .form-control:focus {
        border-color: var(--button-primary-bg) !important; 
        box-shadow: 0 0 0 0.2rem rgba(var(--button-primary-bg),.25) !important; 
        outline: none; 
    }
    .odd-input { text-align: center !important; }

    .badge-secondary-custom {
        background-color: var(--badge-secondary-bg) !important; 
        color: var(--text-color-primary) !important; 
        padding: 0.6em 1em !important; 
        border-radius: 0.4rem !important;
        box-shadow: 0 1px 4px rgba(0,0,0,0.08); 
        font-weight: 600 !important;
        min-width: 80px; 
        text-align: center;
    }
    .copy-btn {
        margin-left: 10px !important; 
        text-decoration: none !important;
        font-weight: 600 !important; 
        font-size: 0.9rem !important; 
        color: var(--copy-btn-color) !important;
        transition: color 0.3s ease;
    }
    .copy-btn:hover {
        color: var(--button-primary-bg) !important; 
        text-decoration: underline !important;
    }

    .btn-primary { 
        background-color: var(--button-primary-bg) !important; 
        border-color: var(--button-primary-border) !important;
        color: var(--button-primary-text) !important;
        font-weight: 600 !important; 
        padding: 0.9rem 2rem !important; 
        border-radius: 0.6rem !important;
        box-shadow: 0 6px 18px rgba(0,0,0,0.15); 
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); 
    }
    .btn-primary:hover {
        transform: translateY(-3px); 
        box-shadow: 0 10px 25px rgba(0,0,0,0.25);
    }
    .btn-warning-custom {
        background-color: var(--button-secondary-bg) !important; 
        color: var(--button-secondary-text) !important; 
        font-weight: 600 !important; 
        padding: 0.9rem 2rem !important; 
        border-radius: 0.6rem !important;
        box-shadow: 0 6px 18px rgba(0,0,0,0.15);
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    .btn-warning-custom:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.25);
    }

    .value-cell-content {
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        height: 100% !important;
        padding: 0 !important;
    }
    .value-cell-content .badge {
        margin-right: 5px !important;
    }

    .info-section {
        margin-top: 3rem !important; 
        padding-top: 2rem; 
        border-top: 1px solid rgba(var(--text-color-primary), 0.1); 
    }
    .info-section h5 .badge {
        background-color: var(--info-badge-bg) !important; 
        color: white !important;
        padding: 0.6rem 1.5rem !important; 
        border-radius: 2rem !important; 
        font-size: 1.05rem !important; 
        font-weight: 700 !important;
        margin-bottom: 1.5rem; 
        display: inline-block; 
        box-shadow: 0 3px 8px rgba(0,0,0,0.1); 
    }
    .info-section p {
        margin-bottom: 1.2rem !important; 
        color: var(--text-color-secondary) !important; 
        line-height: 1.8; 
        font-size: 0.95rem; 
    }
    .info-section a {
        color: var(--info-link-color) !important; 
        font-weight: 600 !important; 
        text-decoration: none;
        transition: color 0.3s ease;
    }
    .info-section a:hover {
        color: var(--button-primary-bg) !important;
        text-decoration: underline;
    }

    /* ESTILOS DO TOGGLE SWITCH - MUDANÇAS PARA RESOLVER O BUG VISUAL EM MOBILE */
    .theme-toggle-container {
        position: absolute;
        top: 30px; 
        right: 30px; 
        z-index: 10;
        display: flex; 
        align-items: center;
        justify-content: center;
    }
    .theme-toggle-switch {
        position: relative;
        display: inline-block;
        width: 65px; 
        height: 38px; 
    }
    .theme-toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--toggle-bg-off); 
        transition: all .4s cubic-bezier(0.25, 0.8, 0.25, 1);
        border-radius: 38px; 
        box-shadow: inset 0 0 8px rgba(0,0,0,0.3); 
    }
    .slider:before {
        position: absolute;
        content: "";
        height: 30px; 
        width: 30px;
        left: 4px;
        bottom: 4px;
        background-color: var(--toggle-circle-off); 
        transition: all .4s cubic-bezier(0.25, 0.8, 0.25, 1);
        border-radius: 50%; 
        box-shadow: 0 3px 6px rgba(0,0,0,0.25); 
    }
    .theme-toggle-switch input:checked + .slider {
        background-color: var(--toggle-bg-on); 
    }
    .theme-toggle-switch input:focus + .slider {
        box-shadow: 0 0 1px var(--toggle-bg-on);
    }
    .theme-toggle-switch input:checked + .slider:before {
        transform: translateX(27px); 
        background-color: var(--toggle-circle-on); 
    }
    /* Ícones dentro do slider (Aprimorados) */
    .slider .icon-sun, .slider .icon-moon {
        position: absolute;
        font-size: 18px; 
        line-height: 38px; /* Ajustado para centralizar com nova altura do slider */
        transition: all 0.4s ease-in-out; 
        opacity: 0; 
        font-weight: 900; 
        text-shadow: 0 0 2px rgba(0,0,0,0.2); 
        display: flex; /* Adicionado para centralizar verticalmente no espaço disponível */
        align-items: center;
        justify-content: center;
        height: 100%; 
        width: 50%; /* Ocupa a largura do slider (dividido por 2) */
        top: 0; 
        left: 0; /* Posição inicial da lua na primeira metade */
    }
    .slider .icon-moon { 
        left: 0; 
        color: var(--toggle-icon-color-off); 
        opacity: 1; 
        transform: translateX(0); /* Posição inicial */
    }
    .slider .icon-sun { 
        left: 50%; /* Posiciona o sol na metade direita */
        color: var(--toggle-icon-color-on); 
        opacity: 0; 
        transform: translateX(0); /* Posição inicial */
    }
    /* Animação dos ícones: Lua sai da vista e Sol entra */
    .theme-toggle-switch input:checked + .slider .icon-moon {
        opacity: 0; 
        transform: translateX(-100%); /* Move a lua totalmente para fora da vista (para a esquerda) */
    }
    .theme-toggle-switch input:checked + .slider .icon-sun {
        opacity: 1; 
        transform: translateX(0); /* O sol permanece na sua posição (já está em left: 50%) */
    }

    /* Ajustes de Responsividade (Media Queries) */
    @media (max-width: 768px) { 
        .container-custom {
            padding: 1.5rem !important; 
            margin: 1.5rem auto !important;
        }
        h1 {
            font-size: 2rem !important; 
            margin-bottom: 1.5rem !important;
        }
        .logo-display img {
            max-height: 100px; 
        }
        #lucroDisplay, #retornoTotalDisplay {
            font-size: 0.95rem !important; 
            padding: 0.5rem 0.8rem !important;
            min-width: 90px;
        }
        .input-group-text, .form-control {
            padding: 0.6rem 0.8rem !important; 
        }
        .odd-label {
            display: none !important; 
        }
        .theme-toggle-container { 
            top: 15px;
            right: 15px;
        }
        .theme-toggle-switch { 
            width: 50px; 
            height: 28px;
        }
        .slider:before {
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
        }
        .theme-toggle-switch input:checked + .slider:before {
            transform: translateX(22px); 
        }
        .slider .icon-sun, .slider .icon-moon { /* Ajustes de ícones para mobile */
            font-size: 14px; 
            line-height: 28px; 
            width: 50%; /* Mantém metade da largura do slider */
            /* Posições ajustadas para ficar dentro do slider menor */
            left: 0; /* Alinha lua na metade esquerda */
            right: 0; /* Alinha sol na metade direita */
            transform: translateX(0) !important; /* Remove transforms específicos de desktop */
        }
        /* Nova Lógica de Posicionamento e Transição para Ícones em Mobile */
        .slider .icon-moon { 
            /* Posiciona a lua na metade esquerda do slider */
            transform: translateX(0) !important; /* Fica na primeira metade */
            left: 0 !important;
        }
        .slider .icon-sun { 
            /* Posiciona o sol na metade direita do slider */
            transform: translateX(0) !important; /* Fica na segunda metade */
            left: 50% !important; /* Move para a segunda metade */
        }
        .theme-toggle-switch input:checked + .slider .icon-moon {
            opacity: 0 !important; 
            transform: translateX(-100%) !important; /* Lua sai para a esquerda */
        }
        .theme-toggle-switch input:checked + .slider .icon-sun {
            opacity: 1 !important; 
            transform: translateX(0) !important; /* Sol fica na posição */
        }
        /* Lucro/Retorno: MANTÉM LADO A LADO, MAS COM AJUSTES DE ESPAÇAMENTO E TAMANHO */
        .row.mobile-align-center {
            display: flex;
            flex-direction: row; 
            flex-wrap: nowrap;
            justify-content: space-around; 
            align-items: center; 
            padding: 0 5px; 
            margin: 0 -5px; 
            width: calc(100% + 10px); 
        }
        .row.mobile-align-center > div {
            flex: 1; 
            min-width: 0; 
            max-width: none; 
            text-align: center; 
            padding: 0 2px; 
        }
        .row.mobile-align-center strong {
            display: block; 
            font-size: 0.85rem; 
            margin-bottom: 2px;
            white-space: nowrap; 
        }
        .input-group {
            flex-wrap: nowrap; 
            width: 100%; 
        }
        .odd-input {
            width: 100%; 
        }
    }
    @media (max-width: 576px) { 
        .container-custom {
            padding: 1rem !important; 
        }
        .info-section h5 .badge {
            font-size: 0.9rem !important; 
            padding: 0.4rem 0.8rem !important;
        }
        .btn-primary, .btn-warning-custom {
            padding: 0.6rem 1rem !important; 
            font-size: 0.9rem !important;
        }
        .row.mobile-align-center strong {
            font-size: 0.75rem; 
        }
        #lucroDisplay, #retornoTotalDisplay {
            font-size: 0.9rem !important; 
            padding: 0.3rem 0.5rem !important;
        }
    }
  </style>
</head>
<body>
  <div class="container-custom">
    <div class="theme-toggle-container">
        <label class="theme-toggle-switch">
            <input type="checkbox" id="themeToggleCheckbox">
            <span class="slider">
                <i class="fas fa-moon icon-moon"></i>
                <i class="fas fa-sun icon-sun"></i>
            </span>
        </label>
    </div>

    <div class="logo-display">
        <img src="aposta_sem_risco_favicon.png" alt="Logo Gol de Bet - Aposta Sem Risco">
    </div>

    <h1 class="text-3xl text-center">Aposta Sem Risco</h1> <div class="mb-3">
        <strong>Investimento:</strong>
        <div class="input-group">
            <span class="input-group-text">R$</span>
            <input type="text" id="valorTotal" placeholder="0,00" class="form-control" onkeyup="handleStakeInput(this)" onblur="formatStakeOnBlur(this)" value="" />
        </div>
    </div>

    <div class="row mb-3 text-center mobile-align-center"> 
        <div class="col-6">
            <strong>Lucro:</strong> <span id="lucroDisplay" class="badge bg-success-custom">R$ 0,00</span>
        </div>
        <div class="col-6">
            <strong>Retorno:</strong> <span id="retornoTotalDisplay" class="badge bg-secondary-custom">R$ 0,00</span>
        </div>
    </div>

    <table class="table table-responsive table-sm table-borderless table-striped">
        <thead class="table-dark">
            <tr>
                <th style="text-align: center;">Odds</th>
                <th style="text-align: center;">Investimento</th>
                <th style="text-align: center;">Retorno</th>
            </tr>
        </thead>
        <tbody id="oddsTableBody">
            </tbody>
        <tfoot>
            <tr>
                <td colspan="3" class="text-center">
                    <button id="adicionarLinhaBtn" type="button" class="btn btn-primary btn-sm w-100 mt-3 mb-2" onclick="adicionarLinha()">Adicionar Mais Linhas</button>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <button type="button" onclick="reiniciar()" class="btn btn-warning-custom btn-sm w-100 mt-2">Reiniciar Calculadora</button>
                </td>
            </tr>
            <tr>
                <td colspan="3" class="info-section">
                    <h5><span class="badge bg-primary">O que significam os termos:</span></h5>
                    <p><strong>Investimento:</strong> O capital que você aloca estrategicamente em suas seleções para garantir um resultado, cobrindo diferentes cenários.</p>
                    <p><strong>Lucro:</strong> O ganho líquido que você realiza, independentemente da seleção vencedora, após todas as suas apostas serem contabilizadas e o investimento inicial coberto.</p>
                    <p><strong>Retorno:</strong> O valor total que retorna ao seu bolso quando uma de suas apostas é vitoriosa, incluindo o que foi apostado naquela linha.</p>
                </td>
            </tr>
            <tr>
                <td colspan="3" class="info-section">
                    <h5><span class="badge bg-primary">Desvendando o Dutching:</span></h5>
                    <p>Dutching é uma técnica inteligente de aposta onde você divide seu investimento em múltiplos resultados dentro de um mesmo evento. O objetivo é ajustar a quantia apostada em cada opção de forma que, se qualquer uma delas vencer, seu lucro seja o mesmo. Isso ajuda a mitigar riscos e a explorar cenários com maior flexibilidade.</p>
                </td>
            </tr>
            <tr>
                <td colspan="3" class="info-section">
                    <h5><span class="badge bg-primary">Dominando as Odds:</span></h5>
                    <p>Odds (cotações) são o coração das apostas. Elas refletem a probabilidade estimada de um evento e definem o quanto você pode ganhar. Odds menores indicam maior chance e menor lucro, enquanto odds maiores oferecem um prêmio mais alto para eventos menos prováveis. Nossa calculadora simplifica isso usando odds decimais, tornando a análise rápida e eficaz.</p>
                </td>
            </tr>
        </tfoot>
    </table>
  </div>

  <script>
    // Formatador para moeda Real (BRL)
    const currencyFormatter = new Intl.NumberFormat('pt-BR', {
      style: 'currency',
      currency: 'BRL',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });

    // Função para formatar números para exibição como moeda (com vírgula para decimal)
    function formatToBRL(value) {
      if (isNaN(value)) {
        return "R$ 0,00";
      }
      return currencyFormatter.format(value);
    }

    // Limpa valor de MOEDA (Investimento) para cálculo
    // Remove R$, espaços, PONTOS DE MILHAR, e substitui vírgula por ponto decimal.
    function cleanCurrencyValue(value) {
      if (String(value).includes(',')) {
          return String(value)
              .replace(/[R$ ]/g, '')
              .replace(/\./g, '')     // Remove PONTOS DE MILHAR
              .replace(/,/g, '.');    // Substitui VÍRGULA por PONTO DECIMAL
      } else {
          return String(value)
              .replace(/[R$ ]/g, '');   // NÃO REMOVE PONTOS AQUI (assume que é decimal se não tem vírgula)
      }
    }

    // Limpa valor DECIMAL (Odds) para cálculo
    // Apenas substitui vírgula por ponto decimal. NÃO remove pontos existentes.
    function cleanDecimalValue(value) {
        return String(value).replace(/,/g, '.'); 
    }

    // --- Funções de tratamento de input para Odds ---
    function handleOddInput(inputElement) {
      inputElement.value = inputElement.value.replace(",", "."); 
      calcularDutching();
    }

    function formatOddOnBlur(inputElement) {
        let value = inputElement.value;
        value = cleanDecimalValue(value); 

        let parsedValue = parseFloat(value);
        if (value === "" || isNaN(parsedValue)) {
            inputElement.value = ""; 
        } else {
            inputElement.value = parsedValue.toFixed(2); 
        }
        calcularDutching();
    }

    // --- Funções de tratamento de input para Valor Total ---
    function handleStakeInput(inputElement) {
      inputElement.value = inputElement.value.replace(",", ".");
      calcularDutching();
    }

    function formatStakeOnBlur(inputElement) {
        let value = cleanCurrencyValue(inputElement.value);
        let parsedValue = parseFloat(value);

        if (value !== "" && !isNaN(parsedValue)) {
            inputElement.value = formatToBRL(parsedValue); 
        } else {
            inputElement.value = "";
        }
        calcularDutching();
    }

    // --- Função principal de Cálculo ---
    function calcularDutching() {
      const valorTotalInput = document.getElementById("valorTotal");
      const stakeString = cleanCurrencyValue(valorTotalInput.value);
      const stake = parseFloat(stakeString);

      const oddsInputs = Array.from(document.querySelectorAll(".odd-input"));
      const odds = oddsInputs
        .map(input => {
            const cleanOdd = cleanDecimalValue(input.value); 
            const floatOdd = parseFloat(cleanOdd);
            return floatOdd;
        })
        .filter(o => !isNaN(o) && o > 0);

      const lucroTotalDisplay = document.getElementById("lucroDisplay");
      const retornoTotalDisplay = document.getElementById("retornoTotalDisplay");

      if (lucroTotalDisplay) lucroTotalDisplay.textContent = formatToBRL(0);
      if (retornoTotalDisplay) retornoTotalDisplay.textContent = formatToBRL(0);

      oddsInputs.forEach((input) => {
        const oddIndex = input.dataset.oddIndex;
        if (oddIndex) {
            const apostaSpan = document.getElementById(`aposta-${oddIndex}`);
            const retornoSpan = document.getElementById(`retorno-${oddIndex}`);
            if (apostaSpan) apostaSpan.textContent = '';
            if (retornoSpan) retornoSpan.textContent = '';
        }
      });


      if (isNaN(stake) || stake <= 0 || odds.length < 2) {
        if (lucroTotalDisplay) {
            lucroTotalDisplay.classList.remove('bg-danger-custom');
            lucroTotalDisplay.classList.add('bg-success-custom');
        }
        return;
      }

      const inversos = odds.map(o => 1 / o);
      const somaInversos = inversos.reduce((a, b) => a + b, 0);

      if (somaInversos === 0 || isNaN(somaInversos)) {
        if (lucroTotalDisplay) {
            lucroTotalDisplay.classList.remove('bg-danger-custom');
            lucroTotalDisplay.classList.add('bg-success-custom');
        }
        return;
      }

      let menorLucro = Infinity; 

      odds.forEach((o, i) => {
        const proporcao = inversos[i] / somaInversos;
        let aposta = stake * proporcao;
        let retornoBruto = aposta * o;

        aposta = parseFloat(aposta.toFixed(2));
        retornoBruto = parseFloat(retornoBruto.toFixed(2));
        
        const lucroCalculado = retornoBruto - stake;

        if (lucroCalculado < menorLucro) {
            menorLucro = lucroCalculado;
        }

        const oddIndex = oddsInputs[i].dataset.oddIndex;
        if (oddIndex) {
            const apostaSpan = document.getElementById(`aposta-${oddIndex}`);
            const retornoSpan = document.getElementById(`retorno-${oddIndex}`);

            if (apostaSpan) apostaSpan.textContent = formatToBRL(aposta);
            if (retornoSpan) retornoSpan.textContent = formatToBRL(retornoBruto);
        }
      });

      if (menorLucro !== Infinity) {
          if (lucroTotalDisplay) {
              lucroTotalDisplay.textContent = formatToBRL(menorLucro);
              if (menorLucro < 0) {
                  lucroTotalDisplay.classList.remove('bg-success-custom');
                  lucroTotalDisplay.classList.add('bg-danger-custom');
              } else {
                  lucroTotalDisplay.classList.remove('bg-danger-custom');
                  lucroTotalDisplay.classList.add('bg-success-custom');
              }
          }
          if (retornoTotalDisplay) retornoTotalDisplay.textContent = formatToBRL(stake + menorLucro);
      }
    }

    // --- Funções de Ação ---
    let currentOddIndex = 0; 

    function criarLinhaOdd(index, value = "") {
        const newRow = document.createElement("tr");
        newRow.innerHTML = `
            <td class="align-middle">
                <div class="input-group">
                    <span class="input-group-text odd-label">${index}º</span>
                    <input type="text" placeholder="Odd" class="form-control odd-input" data-odd-index="${index}" onkeyup="handleOddInput(this)" onblur="formatOddOnBlur(this)" value="${value}" />
                </div>
            </td>
            <td class="align-middle" style="text-align: center; padding: 0;">
                <div class="value-cell-content">
                    <span id="aposta-${index}" class="badge badge-secondary-custom"></span>
                    <a href="#" onclick="copyValue('aposta-${index}'); return false;" class="copy-btn">copiar</a>
                </div>
            </td>
            <td class="align-middle" style="text-align: center; padding: 0;">
                <div class="value-cell-content">
                    <span id="retorno-${index}" class="badge badge-secondary-custom"></span>
                </div>
            </td>
        `;
        return newRow;
    }

    function adicionarLinha() {
      currentOddIndex++; 
      const tableBody = document.getElementById("oddsTableBody");
      tableBody.appendChild(criarLinhaOdd(currentOddIndex));
      calcularDutching();
    }

    function reiniciar() {
      const tableBody = document.getElementById("oddsTableBody");
      tableBody.innerHTML = ''; 
      currentOddIndex = 0;

      adicionarLinha(); 
      adicionarLinha(); 

      document.getElementById("valorTotal").value = ""; 
      formatStakeOnBlur(document.getElementById("valorTotal")); 

      const lucroTotalDisplay = document.getElementById("lucroDisplay");
      const retornoTotalDisplay = document.getElementById("retornoTotalDisplay");
      if (lucroTotalDisplay) lucroTotalDisplay.textContent = formatToBRL(0);
      if (retornoTotalDisplay) retornoTotalDisplay.textContent = formatToBRL(0);

      if (lucroTotalDisplay) {
          lucroTotalDisplay.classList.remove('bg-danger-custom');
          lucroTotalDisplay.classList.add('bg-success-custom');
      }

      calcularDutching();
    }

    // --- Função para Copiar Valor ---
    function copyValue(spanId) {
        const valueToCopy = document.getElementById(spanId).innerText.trim(); 
        const tempInput = document.createElement("input");
        document.body.appendChild(tempInput);
        tempInput.value = valueToCopy;
        tempInput.select();
        document.execCommand("copy");
        document.body.removeChild(tempInput);
    }

    // --- Lógica do Tema (Dark Mode) ---
    const themeToggleCheckbox = document.getElementById('themeToggleCheckbox'); 
    const htmlElement = document.documentElement; // O elemento <html>

    function loadTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            htmlElement.classList.add('dark-theme');
            themeToggleCheckbox.checked = true; 
        } else {
            htmlElement.classList.remove('dark-theme');
            themeToggleCheckbox.checked = false; 
        }
    }

    function toggleTheme() { 
        if (themeToggleCheckbox.checked) { 
            htmlElement.classList.add('dark-theme');
            localStorage.setItem('theme', 'dark');
        } else { 
            htmlElement.classList.remove('dark-theme');
            localStorage.setItem('theme', 'light');
        }
    }

    // --- Inicialização ao carregar a página ---
    document.addEventListener("DOMContentLoaded", function() {
        loadTheme(); 
        themeToggleCheckbox.addEventListener('change', toggleTheme); 
        reiniciar(); 
    });
  </script>
</body>
</html>
